import { JSDOM } from 'jsdom';
import { extractData } from './index';

describe('the scraper', () => {
  it("gets name, city, state, country correctly when there's only one city per state and one person per city", () => {
    const sampleHTML = `
      <div id="certified-list-green">
      <a name="Brazil"></a>
  <table class="bigTable">
          <tbody>
          <tr>
            <td><span class="ccountry">Brazil</span></td>
          </tr>
          <tr></tr>
          </tbody>
        </table>
  <a name="Brazil_CE"></a>
  <table class="stateTable">
            <tbody>
              <tr>
                <td><div style="width: 200px;"></div><span class="cstate">CE</span></td>
                <td>
                  <a name="Brazil_CE_Fortaleza"></a><table class="cityTable">
                    <tbody>
                                      
                    <tr>
                      <td><span class="ccity">Fortaleza</span></td>
                      <td>
                                                                          <table class="guideTable">
                              <tbody>
                              <tr>
                                <td align="right"><div style="width:360px;"></div>
                                  <span class="cguide">Francisco Ferreira de Oliveira Junior</span>
                                                                    <div class="cguide_info"><a href="http://juniormms.com.br" target="_blank">http://juniormms.com.br</a></div>
                                                                                                    <div class="cguide_info"><a href="mailto:juniormms.br@gmail.com"><i class="fa fa-fw fa-envelope"></i>juniormms.br@gmail.com</a></div>
                                                                                                    <div class="cguide_info"><a href="tel:(85)99998-9967"><i class="fa fa-fw fa-phone-square"></i>(85)99998-9967</a></div>
                                                                                                                                                                    <div class="cguide_info"><a href="http://www.instagram.com/juniormmsbr" target="_blank"><i class="fa fa-fw fa-instagram"></i>http://www.instagram.com/juniormmsbr</a></div>
                                  
                                </td>
                              </tr>
                              </tbody>
                            </table>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </td>
                    </tr>
                                      </tbody>
                  </table>
                </td>
              </tr>
            </tbody>
          </table>
  <a name="Brazil_SC"></a>
  <table class="stateTable">
            <tbody>
              <tr>
                <td><div style="width: 200px;"></div><span class="cstate">SC</span></td>
                <td>
                  <a name="Brazil_SC_Florianopolis"></a><table class="cityTable">
                    <tbody>
                                      
                    <tr>
                      <td><span class="ccity">Florianopolis</span></td>
                      <td>
                                                                                                                        <table class="guideTable">
                              <tbody>
                              <tr>
                                <td align="right"><div style="width:360px;"></div>
                                  <span class="cguide">Liza de Brito Rossi</span>
                                                                    <div class="cguide_info"><a href="http://brasilmms.com" target="_blank">http://brasilmms.com</a></div>
                                                                                                    <div class="cguide_info"><a href="mailto:liza@escolamodernademisterios.com.br"><i class="fa fa-fw fa-envelope"></i>liza@escolamodernademisterios.com.br</a></div>
                                                                                                    <div class="cguide_info"><a href="tel:+55 48 99163-4824"><i class="fa fa-fw fa-phone-square"></i>+55 48 99163-4824</a></div>
                                                                                                                                  
                                </td>
                              </tr>
                              </tbody>
                            </table>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          </td>
                    </tr>
                                      </tbody>
                  </table>
                </td>
              </tr>
            </tbody>
          </table>
      </div>
    `;
    const dom = new JSDOM(sampleHTML);
    const result = extractData(dom.window.document);
    expect(result).toEqual([
      expect.objectContaining({
        name: 'Francisco Ferreira de Oliveira Junior',
        city: 'Fortaleza',
        state: 'CE',
        country: 'Brazil'
      }),
      expect.objectContaining({
        name: 'Liza de Brito Rossi',
        city: 'Florianopolis',
        state: 'SC',
        country: 'Brazil'
      })
    ]);
  });

  it("gets other data correctly when all fields present", () => {
    const sampleHTML = `
      <div id="certified-list-green">
      <a name="Canada"></a>
<table class="bigTable">
				<tbody>
				<tr>
					<td><span class="ccountry">Canada</span></td>
				</tr>
				<tr></tr>
				</tbody>
			</table>
<a name="Canada_ON"></a>
<table class="stateTable">
					<tbody>
						<tr>
							<td><div style="width: 200px;"></div><span class="cstate">ON</span></td>
							<td>
								<a name="Canada_ON_Etobicoke"></a><a name="Canada_ON_Mississauga"></a><a name="Canada_ON_Queensville"></a><a name="Canada_ON_Thornhill"></a><a name="Canada_ON_Woodbridge"></a><table class="cityTable">
									<tbody>
									<tr>
										<td><span class="ccity">Thornhill</span></td>
										<td>
																																																																																																																																																																														<table class="guideTable">
														<tbody>
														<tr>
															<td align="right"><div style="width:360px;"></div>
																<span class="cguide">Carla Senft</span>
																																	<div class="cguide_info"><a href="http://www.carlasenft.com" target="_blank">http://www.carlasenft.com</a></div>
																																																	<div class="cguide_info"><a href="mailto:c.senft@me.com"><i class="fa fa-fw fa-envelope"></i>c.senft@me.com</a></div>
																																																	<div class="cguide_info"><a href="tel:6472375483"><i class="fa fa-fw fa-phone-square"></i>6472375483</a></div>
																																																	<div class="cguide_info"><a href="https://www.facebook.com/Carla Senft" target="_blank"><i class="fa fa-fw fa-facebook-square"></i>https://www.facebook.com/Carla Senft</a></div>
																																																	<div class="cguide_info"><a href="https://www.twitter.com/@CarlaSenft" target="_blank"><i class="fa fa-fw fa-twitter-square"></i>https://www.twitter.com/@CarlaSenft</a></div>
																																																	<div class="cguide_info"><a href="https://www.instagram.com/carla.senft" target="_blank"><i class="fa fa-fw fa-instagram"></i>https://www.instagram.com/carla.senft</a></div>
																
															</td>
														</tr>
														</tbody>
													</table>
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																	</td>
									</tr>
																		</tbody>
								</table>
							</td>
						</tr>
					</tbody>
				</table>
      </div>
    `
    const dom = new JSDOM(sampleHTML);
    const result = extractData(dom.window.document);
    expect(result).toEqual([
      {
        name: 'Carla Senft',
        city: 'Thornhill',
        state: 'ON',
        country: 'Canada',
        email: 'c.senft@me.com',
        phone: '6472375483',
        website: 'http://www.carlasenft.com',
        facebook: 'https://www.facebook.com/Carla Senft',
        twitter: 'https://www.twitter.com/@CarlaSenft',
        instagram: 'https://www.instagram.com/carla.senft',
      }
    ]);
  });

  it("gets name, city, state, country correctly when there's multiple cities per state and 1+ people per city", () => {
    const sampleHTML = `
      <div id="certified-list-green">
      <a name="Brazil"></a>
<table class="bigTable">
				<tbody>
				<tr>
					<td><span class="ccountry">Brazil</span></td>
				</tr>
				<tr></tr>
				</tbody>
			</table>
      <a name="Brazil_DF"></a>
<table class="stateTable">
					<tbody>
						<tr>
							<td><div style="width: 200px;"></div><span class="cstate">DF</span></td>
							<td>
								<a name="Brazil_DF_"></a><a name="Brazil_DF_Brasilia"></a><a name="Brazil_DF_Brasília"></a><table class="cityTable">
									<tbody>
																		
									<tr>
										<td><span class="ccity"></span></td>
										<td>
																																																																																																																																																																																																					<table class="guideTable">
														<tbody>
														<tr>
															<td align="right"><div style="width:360px;"></div>
																<span class="cguide">Thalya Alves Aragão</span>
																																																																																																
															</td>
														</tr>
														</tbody>
													</table>
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																			</td>
									</tr>
																		
									<tr>
										<td><span class="ccity">Brasilia</span></td>
										<td>
																																																																																																																																																																																																																												<table class="guideTable">
														<tbody>
														<tr>
															<td align="right"><div style="width:360px;"></div>
																<span class="cguide">Dalila Coelho da Silveira</span>
																																																																																																
															</td>
														</tr>
														</tbody>
													</table>
																																																<table class="guideTable">
														<tbody>
														<tr>
															<td align="right"><div style="width:360px;"></div>
																<span class="cguide">Glauco Nunes de Pinho</span>
																																																																																																
															</td>
														</tr>
														</tbody>
													</table>
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																					</td>
									</tr>
																		
									<tr>
										<td><span class="ccity">Brasília</span></td>
										<td>
																																																																																																																																																																																																																																																																										<table class="guideTable">
														<tbody>
														<tr>
															<td align="right"><div style="width:360px;"></div>
																<span class="cguide">Sônia Aiko Takata</span>
																																																																																																
															</td>
														</tr>
														</tbody>
													</table>
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																														</td>
									</tr>
																		</tbody>
								</table>
							</td>
						</tr>
					</tbody>
				</table>
      </div>
    `;
    const dom = new JSDOM(sampleHTML);
    const result = extractData(dom.window.document);
    expect(result).toEqual([
      expect.objectContaining({
        name: 'Thalya Alves Aragão',
        city: '',
        state: 'DF',
        country: 'Brazil'
      }),
      expect.objectContaining({
        name: 'Dalila Coelho da Silveira',
        city: 'Brasilia',
        state: 'DF',
        country: 'Brazil'
      }),
      expect.objectContaining({
        name: 'Glauco Nunes de Pinho',
        city: 'Brasilia',
        state: 'DF',
        country: 'Brazil'
      }),
      expect.objectContaining({
        name: 'Sônia Aiko Takata',
        city: 'Brasília',
        state: 'DF',
        country: 'Brazil'
      })
    ]);
  });

});
